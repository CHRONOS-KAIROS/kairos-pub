# moirai-ui

## Project setup

To setup the project, you will need the following tools:

-   [nodejs 16.19.0](https://nodejs.org/en/)
    -   this comes with npm command line tool
-   [vue-cli](https://cli.vuejs.org/)
    -   after npm is installed, vue-cli can be installed via the following command:
    ```
    npm install -g @vue/cli
    ```

After you have the tools, check out the repo from Git. Change to the top level folder. Then run the following command:

```
npm install or ./gradlew npmInstall
```

### Compiles and hot-reloads for development

```
npm run serve
```

### In case the code does not seem to be using the correct version of dependencies correctly

```

npm ci
```

### Compiles and minifies for production

```
npm run build or ./gradlew npmBuild
```

### Run your unit tests

```
npm run test:unit
```

### Run your end-to-end tests

```
npm run test:e2e
```

### Lints and fixes files

```
npm run lint
```

### Builds the project and packages it in a docker image named ui:local

```
./gradlew buildDockerImage
```

### Lints and fixes files

```
npm run lint
```
### Customize configuration

See [Configuration Reference](https://cli.vuejs.org/config/).

### GoJS license key

If you have a current GoJS license key, you can set `VUE_APP_GOJS_LICENSE_KEY` in the `.env` file to a quoted string value containing the key.  Without this setting, you will see a watermark in the Visualization component indicating you're using an evaluation license of GoJS.

## Libraries used 

### Vue

Although usually used with JavaScript, our TypeScript code is based on Vue. (At the time of writing this App.vue is in plain JavaScript, however.) Vue documentation advises using Vuex (state management library we're using as an intermediary between the server and components) as well as the Vue router. The code for these features both have their own directory under /src.

There is a great article on how TypeScript and Vue interact here: https://blog.logrocket.com/how-to-write-a-vue-js-app-completely-in-TypeScript/

If you've never used TypeScript before, it's mostly a strongly typed version of JavaScript. You can use JavaScript libraries, but will likely need to bring in supplemental libraries containing types for those libraries: https://medium.com/@steveruiz/using-a-javascript-library-without-type-declarations-in-a-typescript-project-3643490015f3

#### Vuex

Vuex advises that all asynchronous opertations in the application should be encapsulated in store actions, so we've mostly stuck to that paradigm. We reference parts of the store state directly in html such as in v-model attributes but in scripts try to use getters. Setting parts or all of a store state should only happen in mutations through actions. 

#### The .vue file

So far the .vue files have been used 1 .vue file per component. .vue files can contain html, css, and a scripting language all in one file. They allow us to used scoped css (scoping css to a component simply by typing "scoped" next to the style tag). .vue files are the only way to do this. However, keeping all of this together can make a file length, so we often link to an sperate html file for that part. 

### Vuetify
-   Made exclusively for vue by a company that appears to be a sibling to the company which created Vue
-   Set of opinionated tags/attributes with more baked in funcionality than basic html
-   predefined codes for predefined classes: ex. "mb-2" = 8px margin-bottom
-   variables.scss and vuetify.ts define some project-wide customizations
-   One way of identifying vuetify tags is if they are in the format v-*****.

It's a good practice to see if there's any specific Vuetify tags/customs before using basic html and css to create your views. Overriding typical options in the Vue ecosystem can be tedious. Using Vue's system for defining colors and typography, for example, is much easier than overriding using your own css. However, it's acknowldged that to do certain things basic html/css is the only choice. 

An example of how select customizations can be not available in the vuetify framework, yet take tedious adjustments to use in the framework can be found here: https://www.reddit.com/r/vuetifyjs/comments/f6tmw7/how_do_you_change_the_background_color_in_vselect/ . Notice in the link provided in the comment answering the post shows css that required a person looking at the html generated by vuetify itself and making style changes to those tags. This can be dangerous if a new version of vuetify decides to use different tag names, heirarchy etc.

### Nprogress
Vuetify has it's own tag for indicating that the application is loading something; however Nprogress required less code to implement and does not seem to have any issues with the Vuetify ecosystem. 

### Gradle 
Gradle, among other things, is used to help with two important functions:
-   dockerizing the application
-   creating generated code from the openapi.yaml file

### OpenAPI
On the server side (Zeus) the openapi.yaml file is used to generate code as well as swagger documentation. This file can be copied here. TypeScript classes for request objects as well as functions to make the server call are generated from it. 

### RxJS
We are mostly just using RxJS as the framework to integrate with OpenAPI generated code. You'll notice when we call generated code to hit endpoints we use .subscribe to listen to the response; that's an RxJS related concept. 

## Additional notes

### Parent v-snackbar
As of now, different components have been using the v-snackbar (small popup informing users of errors, updates, etc.) in the parent page. This allows us to reuse code, as well as allowing users to still see a message even if the subpage/component changes in the process. This is crucial when redirecting users to the login page upon JWT (cached authentication token) expiration. They should have an alert when this redirection happens explaning their login expired. 
However, we need to be wary of any asynchronous v-snackbar invocations. We should watch out for situations where different messages could step on each other - and maybe change the design pattern if this becomes an issue. 

### Vue variables in Css
We use a trick to use vue data variables in some of the custom Css. How to do something like that is described here: https://www.telerik.com/blogs/passing-variables-to-css-on-a-vue-component
